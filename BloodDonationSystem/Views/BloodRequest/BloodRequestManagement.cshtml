@using BloodDonationSystem.DTOS
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model CreateBloodRequestDTO
@{

    ViewData["Title"] = "Blood Request Management";

}
<div class="BloodRequestStyle container mt-4">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <div class="bloodTypesRequest">
        <h1 class="mb-4">Add new blood request</h1>

        <form asp-controller="BloodRequest" asp-action="CreateBloodRequest" method="post">

            <div class="d-flex flex-wrap  gap-4">
                @for (int i = 0; i < Model.BloodTypes.Count; i++)
                {
                    <div class="card p-3 shadow-sm" style="min-width: 150px;">
                        <input type="hidden" asp-for="BloodTypes[i].BloodTypeId" />
                        <input type="hidden" asp-for="BloodTypes[i].BloodTypeName" />

                        <div class="form-check">
                            <input class="form-check-input"
                                   type="radio"
                                   asp-for="SelectedBloodTypeId"
                                   value="@Model.BloodTypes[i].BloodTypeId"
                                   onchange="enableQuantity(this, @i)"
                                   id="radio_@i" />

                            <label class="form-check-label fw-bold" for="radio_@i">
                                @Model.BloodTypes[i].BloodTypeName
                            </label>
                        </div>

                        <input type="number"
                               asp-for="BloodTypes[i].Quantity"
                               id="qty_@i"
                               class="form-control mt-2 quantity-input"
                               min="1"
                               placeholder=""
                               disabled />
                    </div>
                }
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary btn-lg">Submit Request</button>
            </div>
        </form>
    </div>
</div>

    <br />
    <br/>


<span>Important Note: To make a request active an admin must approve it</span>
<br/>
<div class="w-100">
<table class="table table-striped">
    <thead>
        <tr>
            <th>Id</th>
            <th>Patient Blood Type</th>
            <th>Quantity</th>
            <th>Request Date</th>
            <th>Is active</th>
            <th>Is Approved</th>
            <th>Activate</th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null)
        {
            @foreach (var BloodRequest in Model.BloodRequests)
            {
                <tr>
                    <td>@BloodRequest.Id</td>
                    <td>@BloodRequest.BloodTypeName</td>
                    <td>
                       @BloodRequest.QuantityRequested
                    </td>
                    <td>
                        @BloodRequest.BloodRequestDate
                    </td>
                    <td>
                        @BloodRequest.IsBloodRequestActive
                    </td>
                    <td>
                        @BloodRequest.IsBloodRequestApproved
                    </td>
                    <td>
                        @if (BloodRequest.IsBloodRequestApproved){
                                    @if (!BloodRequest.IsBloodRequestActive)
                                    {
                                        <form asp-controller="BloodRequest"
                                              asp-action="Activate"
                                              asp-route-id="@BloodRequest.Id"
                                              method="post"
                                              style="display:inline">
                                            <button type="submit" class="btn btn-sm btn-primary">
                                                Activate
                                            </button>
                                        </form>
                                    }
                                    else
                                    {
                                        <form asp-controller="BloodRequest"
                                              asp-action="DeActivate"
                                              asp-route-id="@BloodRequest.Id"
                                              method="post"
                                              style="display:inline">
                                            <button type="submit" class="btn btn-sm btn-danger">
                                                DeActivate
                                            </button>
                                        </form>
                                    }
                                }
                                else
                                {
                                    <p>To Activate Request it must <br /> be approved by Admin</p>
                                }
                            </td>
                </tr>
            }
        }
    </tbody>
</table>
</div>
<script>
    function enableQuantity(radioButton, index) {
        // 1. Get all quantity inputs
        const allInputs = document.querySelectorAll('.quantity-input');
        
        // 2. Disable all of them and clear their values
        allInputs.forEach(input => {
            input.disabled = true;
             input.value = ''; 
        });

        // 3. Enable only the specific input next to the selected radio
        const targetInput = document.getElementById(`qty_${index}`);
        if (targetInput) {
            targetInput.disabled = false;
            targetInput.focus();
        }
    }
</script>

